version: "3.8"

services:
    did-web-server:
        build:
            context: .
            dockerfile: Dockerfile
            args:
                # Set your domain here or override with: docker-compose build --build-arg DOMAIN=your-domain.com
                DOMAIN: ${DOMAIN:-known-bulldog-advanced.ngrok-free.app}
        image: did-web-demo:latest
        container_name: did-web-demo
        ports:
            - "3000:3000"
        environment:
            - NODE_ENV=production
            - PORT=3000
        restart: unless-stopped
        healthcheck:
            test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000/health', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"]
            interval: 30s
            timeout: 3s
            retries: 3
            start_period: 5s
        labels:
            - "description=DID:web demonstration server"
            - "version=1.0.0"
# To use this compose file:
#
# 1. Build with your domain:
#    DOMAIN=your-domain.ngrok-free.app docker-compose build
#
# 2. Run the container:
#    docker-compose up -d
#
# 3. View logs:
#    docker-compose logs -f
#
# 4. Stop:
#    docker-compose down
